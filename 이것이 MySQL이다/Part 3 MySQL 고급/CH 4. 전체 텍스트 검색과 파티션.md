# Part 3 MySQL 고급

## CH 4. 전체 텍스트 검색

### 1. 전체 텍스트 검색

#### 1-1 전체 텍스트 검색 개요

- 전체 텍스트 검색은 긴 문자로 구성된 구조화되지 않은 텍스트 데이터 등을 빠르게 검색하기 위한 부가적인 MySQL의 기능
- 전체 텍스트 검색은 저장된 텍스트의 키워드 기반의 쿼리를 위해서 빠른 인덱싱이 가능

#### 1-2 전체 텍스트 인덱스

##### 전체 텍스트 인덱스(FULLTEXT Index) 생성

- 전체 텍스트 인덱스는 텍스트로 이루어진 문자열 데이터의 내용을 가지고 생성한 인덱스
- 일반적인 인덱스와의 차이점
  - 전체 텍스트 인덱스는 InnoDB와 MyISAM 테이블만 지원한다.
  - 전체 텍스트 엔덱스는 char, varchar, text의 열에만 생성이 가능하다.
  - 인덱스 힌트의 사용이 일부 제한된다.
  - 여러 개의 열에 FULLTEXT 인덱스를 지정할 수 있다.

```SQL
-- 전체 텍스트 인덱스 생성 방법
-- 형식 1
CREATE TABLE 테이블이름 (
    ...
    열이름 데이터형식,
    ...,
    FULLTEXT 인덱스이름 (열이름)
);

-- 형식 2
CREATE TABLE 테이블이름 (
    ...
    열이름 데이터형식,
    ...
);
ALTER TABLE 테이블이름
    ADD FULLTEXT (열이름);

-- 형식 3
CREATE TABLE 테이블이름 (
    ...
    열이름 데이터형식,
    ...
);
CREATE FULLTEXT INDEX 인덱스이름
ON 테이블이름 (열이름);
```

##### 전체 텍스트 인덱스 삭제

```SQL
ALTER TABLE 테이블이름
    DROP INDEX FULLTEXT(열이름);
```

##### 중지 단어

<p>
    전체 텍스트 인덱스는 긴 문장에 대해서 인덱스를 생성하기 때문에 그 양이 커질 수밖에 없다. 그러므로 실제로 검색에서 무시할 만한 단어들은 아예 전체 텍스트 인덱스로 생성하지 않는 편이 좋을 것이다. MySQL 5.7에서 INFORMATION_SCHEMA.INNODB_FT_DEFAULT_STOPWORD 테이블에 약 36개의 중지 단어(stopwords)를 가지고 있다.(a, about, an, are, as, at, ...)
</p>

<p>
    필요하다면 사용자가 별도의 테이블에 중지 단어를 추가한 후 적용시킬 수도 있다. 그리고 전체 텍스트 인덱스를 생성할 때 이 중지 단어들을 적용시키면 MySQL은 중지 단어를 제외하고 전체 텍스트 인덱스를 만들어 주게 된다. 결국, 전체 텍스트 인덱스의 크기가 최소화될 수 있다.
</p>

##### 전체 텍스트 검색을 위한 쿼리

<p>
    전체 텍스트 인덱스를 생성한 후에, 전체 텍스트 인덱스를 이용하기 위한 쿼리는 일반 SELECT문의 WHERE절에 MATCH(), AGAINST()를 사용하면 된다.
</p>

```SQL
MATCH (col1, col2, ...) AGAINST (expr [search_modifier])

search_modifier:
{
    IN NATURAL LANGUAGE MODE
    | IN NATURAL LANGUAGE MODE WITH QUERY EXPANSION
    | IN BOOLEAN MODE
    | WITH QUERY EXPANSION
}
```

- 자연어 검색: 특별히 옵션을 지정하지 않거나 `IN NATURAL LANGUAGE MODE`를 붙이면 자연어 검색을 하며, 자연어 검색은 단어가 정확한 것을 검색해 준다.
- 불린 모드 검색: 불린 모드 검색은 단어나 문장이 정확히 일치하지 않는 것도 검색하는 것을 말하며, `IN BOOLEAN MODE` 옵션을 붙여야 한다. 또한, 불린 모드 검색은 필수인 +, 제외하기 위한 -, 부분 검색을 위한 * 연산자 등의 다양한 연산자를 지원한다.

### 2. 파티션

#### 2-1 파티션 개요

- 파티션(Partition)은 대량의 테이블을 물리적으로 여러 개의 테이블로 쪼개는 것
- 테이블을 분할 할 때는 테이블의 범위에 따라서 서로 다른 파티션에 저장하는 것이 가장 보편적

#### 2-2 파티션의 정리

- 파티션 테이블에 외래 키를 설정할 수 없다. 그러므로 단독으로 사용되는 테이블에만 파티션을 설정할 수 있다.
- 스토어드 프로시저, 스토어드 함수, 사용자 변수 등을 파티션 함수나 식에 사용할 수 없다.
- 임시 테이블은 파티션 기능을 사용할 수 없다.
- 파티션 키에는 일부 함수만 사용할 수 있다.
- 파티션 개수는 최대 1024개까지 지원된다.
- 레인지 파티션은 숫자형의 연ㄴ속된 범위를 사용하고, 리스트 파티션은 숫자형 또는 문자형의 연속되지 않은 하나하나씩의 파티션 키 값을 지정한다.
- 리스트 파티션에는 MAXVALUE를 사용할 수 없다. 즉, 모든 경우의 파티션 키 값을 지정해야 한다.
